{% extends "app/layout.html" %}

{% block content %}
<div id="session_list">
    {% verbatim %}
    <v-list two-line>
        <template v-for="(item, index) in items" v-if="modules[item.module_key]">
            <v-list-tile @click="window.location=item.session_link" :key="item.title">
                <v-list-tile-content>
                    <v-list-tile-title><a :href="item.module_link">{{ item.module }}</a></v-list-tile-title>
                    <v-list-tile-sub-title class="text--primary">{{ item.time }}</v-list-tile-sub-title>
                    <v-list-tile-sub-title>[{{ item.type }}] {{ item.place }}</v-list-tile-sub-title>
                </v-list-tile-content>
                <v-list-tile-action>
                    <v-list-tile-action-text>{{ item.duration }}</v-list-tile-action-text>
                    <span v-if="item.attendance_rate">{{ (item.attendance_rate*100).toFixed(1) + "%" }}</span>
                    <a title="Download Attendance Sheet" v-else :href="item.sheet_download" ><v-icon color="grey lighten-1">attach_file</v-icon></a>
                </v-list-tile-action>
            </v-list-tile>
            <v-divider v-if="index + 1 < items.length" :key="index"></v-divider>
        </template>
    </v-list>
    {% endverbatim %}
    <div class="row">
        <div class="col l3">
            <ul class="collection with-header">
                <li class="collection-header"><h6>Modules</h6></li>
                {% for m in modules %}
                <li class="collection-item">
                    <label>
                        <input type="checkbox" checked="checked" v-model="modules.pk_{{ m.pk }}"/>
                        <span>{{ m }}</span>
                    </label>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    var session_list = new Vue({
        el: '#session_list',
        data: {
            "modules": {
                {% for m in modules %}
                "pk_{{ m.pk }}": true,
                {% endfor %}
            },
            rowsPerPageItems: [16, 32, 64],
            pagination: {
              rowsPerPage: 4
            },
            items: [
                {% for s in sessions %} {
                "module": "{{ s.module }}",
                "module_key": "pk_{{ s.module.pk }}",
                "time": "{{ s.time }}",
                "duration": "{{ s.duration }}",
                "place": "{{ s.place }}",
                "type": "{{ s.get_type_display }}",
                "attendance_rate": {% if s.attendance_rate %}{{ s.attendance_rate }}{% else %}null{% endif %},
                "session_link": "{% url 'session_detail' s.pk %}",
                "module_link": "{% url 'module_detail' s.module.pk %}",
                "sheet_download": "{% url 'session_download_attendance_sheet' s.pk %}" },
            {% endfor %}
            ]
        }
    });
</script>
{% endblock %}